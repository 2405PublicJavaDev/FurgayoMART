<!DOCTYPE html>
<html lang="ko" xmlns:th="http://thymeleaf.org">
<head>
<meta charset="UTF-8">
<title>상품 수정하기</title>
<link rel="stylesheet" href="/css/product/admin/modify.css">
</head>
<body>
	<div class="header">
        <h2>관리자 페이지</h2>
        <div class="header-menu">
            <a href="#">관리자님</a>
            <button>로그아웃</button>
        </div>
    </div>
    <div class="container">
            <ul class="sidebar">
                <li>
                    <a href="#">공지사항 관리</a>
                </li>
                <li>
                    <a href="#">리뷰 관리</a>
                </li>
                <li>
                    <a href="#">회원 관리</a>
                </li>
                <li>
                    <a href="#">상품 관리</a>
                    <ul>
                        <li>
                            <a href="/admin/product/register">상품 등록</a>
                        </li>
                        <li>
                            <a href="/admin/product/list">상품 조회</a>
                        </li>
                    </ul>
                </li>
            </ul>        
        <div class="content">
            <h2>상품 수정하기</h2>
            <form th:action="@{/admin/product/{pNo}/modify(pNo=${product.pNo})}" method="post" enctype="multipart/form-data">
                <div class="form-group">
                    <div class="form-top">
                        <div class="form-left">
                            <ul>
                                <li>
                                    <label for="name">상품명</label>
                                    <input type="text" id="pName" name="pName" th:value="${product.pName}" required>
                                </li>
                                <li>
                                    <label for="category">상품 유형</label>
                                    <select id="category" name="categoryNo" th:field="${product.categoryNo}">
									    <option value="999" th:selected="${product.categoryNo == 999}">전체</option>
									    <option value="1" th:selected="${product.categoryNo == 1}">한식</option>
									    <option value="2" th:selected="${product.categoryNo == 2}">중식</option>
									    <option value="3" th:selected="${product.categoryNo == 3}">일식</option>
									</select>
                                </li>
                                <li>
                                    <label for="pPrice">상품 가격</label>
                                    <input type="number" id="pPrice" name="pPrice" th:value="${product.pPrice}" required>
                                </li>
                                <li>
                                    <label for="starDate">유통 기한</label>
                                    <input type="date" id="expiration" name="expiration" th:value="${product.expiration}">
                                </li>
                                <li>
                                    <label for="sale">할인율</label>
                                    <input type="number" id="sale" name="sale" min="0" max="100" th:value="${product.sale}">
                                </li>
                                
                            </ul>
                        </div>
                        <div class="form-right">
                            <ul>
                                <li>
                                	<label>대표 이미지</label>
                                    <div class="image-upload">
                                    	<input type="file" id="imgMain" name="imgMainFile" accept="image/*" onchange="readURL(this, 'mainPreview')">
                                   		<!-- 대표 이미지 미리보기 -->
										<img id="mainPreview"
									     th:src="${productDetail != null && productImage.filePath != null} ? ${productImage.filePath} : '/images/noimage.jpg'">
									    <!-- data-existing-src="${productDetail != null && productDetail.imgMain != null ? '/images/' + productDetail.imgMain : '/images/noimage.png'}"  -->
                                         
									</div>
                                </li>
                                <li>
                                    <label for="inventory">입고량</label>
                                    <input type="number" id="pInput" name="pInput" th:value="${product.pInput}" required>
                                </li>
                                <li>
                                    <label for="inventory">출고량</label>
                                    <input type="number" id="pOutput" name="pOutput" th:value="${product.pOutput}">
                                </li>
                            </ul>
                        </div>
                    </div>
                    <div class="form-bottom">
                        <ul>
                            <li>
                                <label for="name">상품설명</label>
                            </li>
                            <li>
                                <label>조리된 사진</label>
                                <div class="image-upload">
                                <input type="file" id="imgCook" name="imgCookFile" accept="image/*" onchange="readURL(this, 'cookPreview')">
                                <img id="cookPreview" 
								     th:src="${productDetail != null && productImage.filePath != null} ? ${productImage.filePath} : '/images/noimage.jpg'" >
								     <!-- data-existing-src="${productDetail != null && productDetail.imgCook != null ? '/images/' + productDetail.imgCook : '/images/noimage.png'}" > -->
							     </div>
							</li>
                            <li>
                                <label>상품 구성 사진</label>
                                <div class="image-upload">
                                     <input type="file" id="imgComponent" name="imgComponentFile" accept="image/*" onchange="readURL(this, 'componentPreview')">
	                                 <img id="componentPreview" 
								      th:src="${productDetail != null && productImage.filePath != null} ? ${productImage.filePath} : '/images/noimage.jpg'" >
								      <!-- data-existing-src="${productDetail != null && productDetail,imgComponent != null ? '/images/' + productDetail.imgComponent : '/images/noimage.png'}"> -->
                                </div>
                            </li>
                            <li>
                                <label>상품 구성</label>
                                <input type="text" id="pComponent" name="pComponent" th:value="${product.productDetail.pComponent}" required>
                            </li>
                            <li>
                                <label>조리법</label>
                                <input type="text" id="cook" name="cook" th:value="${product.productDetail.cook}">
                            </li>
                            <li>
                                <label>추가 정보</label>
                                <input type="text" id="content" name="content" th:value="${product.productDetail.content}">
                            </li>
                        </ul>
                    </div>
                </div>
                <div class="form-bottom">
                    <div class="buttons">
                        <button type="reset">초기화</button>
                        <button type="submit" id="modify">수정</button>
                    </div>
                </div>
            </form>
        </div>
    </div>
    <script>
    
    // 이미지 미리보기
	    function readURL(input, previewId){
	        if (input.files && input.files[0]) {
	            var reader = new FileReader();
	            reader.onload = function(e) {
			        var preview = document.getElementById(previewId);
			        
			        var uploadBox = preview.parentElement;
	                preview.src = e.target.result;
	                preview.style.display = 'block';
	            }
	            reader.readAsDataURL(input.files[0]);
	        } else {
	            preview.src = preview.getAttribute('data-existing-src');
	        }
	    }
    

        // 입고량, 출고량
        const pInput = document.getElementById('pInput');
        const pOutput = document.getElementById('pOutput');
        const form = document.querySelector('form'); 

        function validateInput() {
            const inputVal = parseInt(pInput.value);
        }
        function validateOutput() {
            const inputVal = parseInt(pInput.value);
            const outputVal = parseInt(pOutput.value);

            if (outputVal > inputVal) {
                alert("출고량은 입고량보다 많을 수 없습니다.");
                pOutput.value = "";
            }
        }
        pOutput.addEventListener('output', validateOutput);
        pInput.addEventListener('input', validateInput);

        form.addEventListener('submit', function(event) {
            const inputVal = parseInt(pInput.value);
            const outputVal = parseInt(pOutput.value);

            if (outputVal > inputVal) {
                alert("출고량은 입고량보다 많을 수 없습니다.");
                event.preventDefault(); 
            }
        });
    </script>
</body>
</html>