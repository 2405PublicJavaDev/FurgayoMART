<!DOCTYPE html>
<html lang="ko" xmlns:th="http://thymeleaf.org">
<head>
<meta charset="UTF-8">
<title>상품 수정</title>
<link rel="stylesheet" href="/css/commonAdmin.css">
<link rel="stylesheet" href="/css/product/admin/modify.css">
</head>
<body>
	<header>
    <div class="header-left">
        <a href="/" class="logo">
            <img src="/images/logo.png" alt="Fugayo's Mart Logo" class="headerimage">
        </a>
        <a href="/admin"> <div class="logo-text">관리자 페이지</div> </a><!-- 텍스트에 별도 클래스 추가 -->
    </div>
    <!--    <nav>-->
    <!--        <ul>-->
    <!--            <li><a href="#">홈</a></li>-->
    <!--            <li><a href="#">리뷰</a></li>-->
    <!--            <li><a href="#">공지사항</a></li>-->
    <!--            <li><a href="#">문의하기</a></li>-->
    <!--        </ul>-->
    <!--    </nav>-->
    <div class="user-info">
        <a href="/member/mypage"> <span>관리자 님</span></a>
        <a href="/member/login">로그아웃</a>
    </div>
</header>
    <div class="container">
            <ul class="sidebar" style="font-weight: bold; font-size: 17px;">
                <li>
                    <a href="#">공지사항 관리</a>
                </li>
                <li>
                    <a href="#">리뷰 관리</a>
                </li>
                <li>
                    <a href="#" class="dropbtn">상품 관리</a>
                    <ul class="dropdown-content">
                        <li><a href="/admin/product/register">상품 등록</a></li>
                        <li><a href="/admin/product/list" class="active">상품 조회</a></li>
                    </ul>
                </li>
            </ul>        
        <div class="content">
            <h2>상품 수정하기</h2>
            <form th:action="@{/admin/product/{pNo}/modify(pNo=${product.pNo})}" method="post" enctype="multipart/form-data">
                <div class="form-group">
                    <div class="form-top">
                        <div class="form-left">
                            <ul>
                                <li>
                                    <label for="name">상품명 *</label>
                                    <input type="text" id="pName" name="pName" th:value="${product.pName}" required>
                                </li>
                                <li>
                                    <label for="category">상품 유형 *</label>
                                    <select id="category" name="categoryNo" th:field="${product.categoryNo}">
									    <option value="999" th:selected="${product.categoryNo == 999}">전체</option>
									    <option value="1" th:selected="${product.categoryNo == 1}">한식</option>
									    <option value="2" th:selected="${product.categoryNo == 2}">중식</option>
									    <option value="3" th:selected="${product.categoryNo == 3}">일식</option>
									</select>
                                </li>
                                <li>
                                    <label for="pPrice">상품 가격 *</label>
                                    <input type="number" id="pPrice" name="pPrice" th:value="${product.pPrice}" required>
                                </li>
                                <li>
                                    <label for="starDate">유통 기한 *</label>
                                    <input type="date" id="expiration" name="expiration" th:value="${product.expiration}">
                                </li>
                                <li>
                                    <label for="sale">할인율</label>
                                    <input type="number" id="sale" name="sale" min="0" max="100" th:value="${product.sale}">
                                </li>
                                
                            </ul>
                        </div>
                        <div class="form-right">
                            <ul>
                                <li>
                                	<label>대표 이미지 *</label>
                                    <div class="image-upload">
                                    	<input type="file" id="imgMain" name="imgMainFile" accept="image/*" onchange="readURL(this, 'mainPreview')">
                                   		<!-- 대표 이미지 미리보기 -->
										<img id="mainPreview" 
											th:src="${product.imgMainUrl != null ? product.imgMainUrl : '/images/noimage.jpg'}" 
											data-existing-src="${product.imgMainUrl != null ? product.imgMainUrl : '/images/noimage.jpg'}"
										>
									</div>
                                </li>
                                <li>
                                    <label for="inventory">입고량 *</label>
                                    <input type="number" id="pInput" name="pInput" th:value="${product.pInput}" required>
                                </li>
                                <li>
                                    <label for="inventory">출고량</label>
                                    <input type="number" id="pOutput" name="pOutput" th:value="${product.pOutput}">
                                </li>
                            </ul>
                        </div>
                    </div>
                    <div class="form-bottom">
                    	<label for="name" style="margin-bottom: 30px;">상품설명</label>
                        <ul>
                            <li>
                                <label>조리된 사진</label>
                                <div class="image-upload">
                                <input type="file" id="imgCook" name="imgCookFile" accept="image/*" onchange="readURL(this, 'cookPreview')">
                                <img id="cookPreview" 
                                	th:src="${product.imgCookUrl != null ? product.imgCookUrl : '/images/noimage.jpg'}" 
                                	data-existing-src="${product.imgCookUrl != null ? product.imgCookUrl : '/images/noimage.jpg'}"
                               	>
							     </div>
							</li>
                            <li>
                                <label>상품 구성 사진</label>
                                <div class="image-upload">
                                     <input type="file" id="imgComponent" name="imgComponentFile" accept="image/*" onchange="readURL(this, 'componentPreview')">
	                                 <img id="componentPreview" 
	                                 	th:src="${product.imgComponentUrl != null ? product.imgComponentUrl : '/images/noimage.jpg'}" 
	                                 	data-existing-src="${product.imgComponentUrl != null ? product.imgComponentUrl : '/images/noimage.jpg'}"
	                                 >
                                </div>
                            </li>
                            <li>
                                <label>상품 구성 *</label>
                                <textarea id="pComponent" name="pComponent" required
                                          th:text="${product.productDetail.pComponent}"></textarea>
                            </li>
                            <li>
                                <label>조리법</label>
                                <textarea id="cook" name="cook"
                                          th:text="${product.productDetail.cook}"></textarea>
                            </li>
                            <li>
                                <label>추가 정보</label>
                                <textarea id="content" name="content"
                                          th:text="${product.productDetail.content}"></textarea>
                            </li>
                            
                        </ul>
                    </div>
                </div>
                <div class="form-bottom">
                    <div class="buttons">
                        <button type="reset" onclick="reLoad()">초기화</button>
                        <button type="submit" id="modify">수정</button>
                    </div>
                </div>
            </form>
        </div>
    </div>
    <!-- <footer>
		<ul class="footer-text">
			<li><a href="/introduce">회사 소개</a></li>
			<li><a href="/notice/admin">공지사항</a></li>
			<li><a href="/inquiry">문의 하기</a></li>
			<li><a href="/policy">운영 정책</a></li>
		</ul>
	</footer> -->
    <script>
    function reLoad() {
		location.reload();
	}
    function readURL(input, previewId) {
        var preview = document.getElementById(previewId);

        if (input.files && input.files[0]) {
            // 파일이 선택된 경우: 새 이미지로 미리보기 설정
            var reader = new FileReader();
            reader.onload = function(e) {
                preview.src = e.target.result;
            }
            reader.readAsDataURL(input.files[0]);
        } else {
            // 파일이 선택되지 않은 경우: 기존 이미지 유지
            preview.src = preview.getAttribute('data-existing-src');
        }
    }

        // 입고량, 출고량
        const pInput = document.getElementById('pInput');
        const pOutput = document.getElementById('pOutput');
        const form = document.querySelector('form'); 

        function validateInput() {
            const inputVal = parseInt(pInput.value);
        }
        function validateOutput() {
            const inputVal = parseInt(pInput.value);
            const outputVal = parseInt(pOutput.value);

            if (outputVal > inputVal) {
                alert("출고량은 입고량보다 많을 수 없습니다.");
                pOutput.value = "";
            }
        }
        pOutput.addEventListener('output', validateOutput);
        pInput.addEventListener('input', validateInput);

        form.addEventListener('submit', function(event) {
            const inputVal = parseInt(pInput.value);
            const outputVal = parseInt(pOutput.value);

            if (outputVal > inputVal) {
                alert("출고량은 입고량보다 많을 수 없습니다.");
                event.preventDefault(); 
            }
        });

        document.addEventListener('DOMContentLoaded', function() {
			var dropbtns = document.querySelectorAll('.sidebar .dropbtn');
			
			dropbtns.forEach(function(btn) {
				btn.addEventListener('click', function(e) {
					e.preventDefault();
					this.classList.toggle('active');
					var content = this.nextElementSibling;
					content.classList.toggle('show');
				});
			});
		});
    </script>
</body>
</html>