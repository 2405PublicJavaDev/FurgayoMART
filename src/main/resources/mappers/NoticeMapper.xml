<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.mart.boot.notice.mapper.NoticeMapper">

    <!-- 공지사항 등록 -->
    <insert id="insertNotice" parameterType="com.mart.boot.notice.model.NoticeVO">
        INSERT INTO NOTICE (
            NOTICE_TITLE,
            NOTICE_CONTENT,
            NOTICE_WRITER,
            USER_ID,
            NOTICE_PINNED
        ) VALUES (
                     #{noticeTitle},
                     #{noticeContent,jdbcType=CLOB},
                     #{noticeWriter},
                     #{userId},
                     #{noticePinned}
                 )
    </insert>

    <!-- 공지사항 수정 -->
    <update id="updateNotice" parameterType="com.mart.boot.notice.model.NoticeVO">
        UPDATE NOTICE
        SET NOTICE_TITLE = #{noticeTitle},
            NOTICE_CONTENT = #{noticeContent,jdbcType=CLOB},
            NOTICE_WRITER = #{noticeWriter},
            NOTICE_PINNED = #{noticePinned},
            NOTICE_MODIFY = SYSDATE
        WHERE NOTICE_NO = #{noticeNo}
    </update>

    <!-- 공지사항 삭제 -->
    <delete id="deleteNotice" parameterType="int">
        DELETE FROM NOTICE WHERE NOTICE_NO = #{noticeNo}
    </delete>

    <!-- 공지사항 단건 조회 -->
    <select id="selectNoticeById" parameterType="int" resultType="com.mart.boot.notice.model.NoticeVO">
        SELECT NOTICE_NO, NOTICE_TITLE, NOTICE_CONTENT, NOTICE_WRITER, NOTICE_DATE, USER_ID, NOTICE_MODIFY, NOTICE_PINNED
        FROM NOTICE
        WHERE NOTICE_NO = #{noticeNo}
    </select>

    <!-- 공지사항 목록 조회 (검색 기능 추가) -->
    <select id="selectNotices" parameterType="map" resultType="com.mart.boot.notice.model.NoticeVO">
        SELECT NOTICE_NO, NOTICE_TITLE, NOTICE_CONTENT, NOTICE_WRITER, NOTICE_DATE, USER_ID, NOTICE_MODIFY, NOTICE_PINNED
        FROM NOTICE
        <where>
            <if test="searchKeyword != null and !searchKeyword.isEmpty()">
                <choose>
                    <when test="searchType == 'title'">
                        NOTICE_TITLE LIKE CONCAT('%', #{searchKeyword}, '%')
                    </when>
                    <when test="searchType == 'content'">
                        NOTICE_CONTENT LIKE CONCAT('%', #{searchKeyword}, '%')
                    </when>
                    <when test="searchType == 'writer'">
                        NOTICE_WRITER LIKE CONCAT('%', #{searchKeyword}, '%')
                    </when>
                </choose>
            </if>
        </where>
        ORDER BY NOTICE_NO DESC
    </select>

    <!-- 공지사항 총 개수 조회 (검색 기능 추가) -->
    <select id="countNotices" parameterType="map" resultType="int">
        SELECT COUNT(*)
        FROM NOTICE
        <where>
            <if test="searchKeyword != null and !searchKeyword.isEmpty()">
                <choose>
                    <when test="searchType == 'title'">
                        NOTICE_TITLE LIKE CONCAT('%', #{searchKeyword}, '%')
                    </when>
                    <when test="searchType == 'content'">
                        NOTICE_CONTENT LIKE CONCAT('%', #{searchKeyword}, '%')
                    </when>
                    <when test="searchType == 'writer'">
                        NOTICE_WRITER LIKE CONCAT('%', #{searchKeyword}, '%')
                    </when>
                </choose>
            </if>
        </where>
    </select>

    <!-- 공지사항 총 개수 조회 -->
    <select id="getTotalNoticeCount" resultType="int">
        SELECT COUNT(*) FROM NOTICE
    </select>

</mapper>
